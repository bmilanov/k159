/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
#include <stdint.h>
#include <string.h>

#include "k159.h"
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
#define K159_USB_VENDOR_ID  UINT16_C(0x5053) 
#define K159_USB_PRODUCT_ID UINT16_C(0x0001)

#define K159_USB_MANUFACTURER_STRING "PASAT ELECTRONICS-Bulgaria"
#define K159_USB_PRODUCT_STRING      "Relay Board-8"

#define K159_USB_REQUEST_TYPE_READ  UINT8_C(0xC0)
#define K159_USB_REQUEST_TYPE_WRITE UINT8_C(0x40)

#define K159_USB_REQUEST_READ  UINT8_C(0x02)
#define K159_USB_REQUEST_WRITE UINT8_C(0x01)

#define K159_USB_REQUEST_INDEX UINT8_C(0x00)
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
void
k159_get_relays
(
    struct k159_context const * const k159_ctx,
    uint8_t * const relays
)
{
    k159_ctx->usb_control_transfer(K159_USB_REQUEST_TYPE_READ, K159_USB_REQUEST_READ, 0x00, K159_USB_REQUEST_INDEX, relays, 1);
}
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
void
k159_set_relays
(
    struct k159_context const * const k159_ctx,
    uint8_t relays
)
{
    uint8_t dummy[2];

    k159_ctx->usb_control_transfer(K159_USB_REQUEST_TYPE_WRITE, K159_USB_REQUEST_WRITE, relays, K159_USB_REQUEST_INDEX, dummy, 1);
}
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
uint16_t
k159_get_usb_vendor_id
(
)
{
    return K159_USB_VENDOR_ID;
}
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
uint16_t
k159_get_usb_product_id
(
)
{
    return K159_USB_PRODUCT_ID;
}
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
void
k159_get_manufacturer_string
(
    uint8_t * const buffer,
    uint8_t * const size
)
{
    strncpy(buffer, K159_USB_MANUFACTURER_STRING, sizeof(K159_USB_MANUFACTURER_STRING));
    *size = sizeof(K159_USB_MANUFACTURER_STRING);
}
/* -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- */
/* -------------------------------------------------------------------------- */
void
k159_get_product_string
(
    uint8_t * const buffer,
    uint8_t * const size
)
{
    strncpy(buffer, K159_USB_PRODUCT_STRING, sizeof(K159_USB_PRODUCT_STRING));
    *size = sizeof(K159_USB_PRODUCT_STRING);
}
/* -------------------------------------------------------------------------- */
